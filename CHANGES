Complete change log for PanDA Pilot version PICARD
--------------------------------------------------


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

63.0

Added ddmEndPointIn, ddmEndPointOut, ddmEndPointLog to Job class, and handling in displayJob() and setJobDef() (Job)
Moved exception handling for utility subprocess from executePayload() to getUtilitySubprocess() (RunJob)
Making sure that the subprocess is still running in executePayload() (RunJob)
Setting memory info = -1 in case of file reading trouble or if memory summary file was not updated in less than 120 s in getUtilityInfo(). Reqested by Rodney Walker (PandaServerClient) 
Added error code 1234, ERR_EXECUTEDCLONEJOB: "Already executed clone job" (PilotErrors)
Now using event range functions to determine whether a cloned job should be executed in executePayload() and __main__() (RunJob)
Moved extractEventRanges() from RunJobEvent to RunJob (RunJob, RunJobEvent)
Setting ATHENA_PROC_NUMBER to 1 on single code nodes in __main__() (RunJobEvent)
Removed test method updatePilotErrorReport() and renamed updatePilotErrorReportTMP() to updatePilotErrorReport() (FileHandling)
Now recognizing a cvmfs time out in getProperSiterootAndCmtconfig() (ATLASExperiment)
Using updatePilotErrorReport to set the error priority in getJobExecutionCommand() (ATLASExperiment)
Created optional getGUIDSourceFilename() (Experiment, ATLASExperiment)
Added experiment argument to getOutFilesGuids() (RunJobUtilities)
Now sending experiment name to getOutFilesGuids() in createFileMetadata() (RunJob)
Importing getExperiment, getGUID (RunJobUtilities)
Created shouldExecuteBenchmark() and executeBenchmark() (SiteInformation, ATLASSiteInformation)
Moved getSiteInformation() to collect WN info section in runMain() (pilot)
Created getBenchmarkDictionary() (Node)
Now getting the benchmark dictionary in runMain() (pilot)
Now setting job to failed in __killLoopingJob() for stuck stage-outs (Monitor)
Added optional ddmEndPointIn argument to getPoolFileCatalog() (Mover)
Created buildFAXPath() (Experiment)
Sending optional computingSite and sourceSite to getFileInfo() from mover_get_data() (Mover)
Added optional computingSite and sourceSite arguments to getFileInfo(), getPoolFileCatalog() (Mover)
Sending optional computingSite and sourceSite to getPoolFileCatalog() from getFileInfo() (Mover)
Created FAXTools module
Moved _getFAXRedirectors() and getFAXRedirectors() from FAXSiteMover to FAXTools
Moved updateRedirector() from FAXSiteMover to FAXTools
Sending ddmEndPointIn to getPoolFileCatalog() from getFileInfo() (Mover)
Added optional argument ddmEndPointIn to getPoolFileCatalog() (Mover)
Sending ddmEndPointIn to getFileInfo() from mover_get_data() (Mover)
Added optional argument ddmEndPointIn to getPoolFileCatalog() (RunJobEvent)
Sending ddmEndPointIn to Mover::getPoolFileCatalog() from RunJobEvent::getPoolFileCatalog() (RunJobEvent)
Added argument ddmEndPointIn to createPoolFileCatalog() (RunJobEvent)
Sending ddmEndPointIn to Mover::getPoolFileCatalog() from RunJobEvent::createPoolFileCatalog() (RunJobEvent)
Sending job.ddmEndPointIn to createPoolFileCatalog() from __main__() (RunJobEvent)
Sending ddmEndPointIn to getPoolFileCatalog() from createPoolFileCatalogFromMessage() (RunJobEvent)
Updated findGlobalFilePath() and getGlobalFilePaths() to accept already defined FAX paths (i.e. taken from PFC) (FAXSiteMover)
Renamed file_list to file_dictionary in createPoolFileCatalog() (pUtil)
Created storeWorkDirSize(), used by __checkWorkDir() (FileHandling, Monitor)
Created getMaxWorkDirSize(), used by addToJobMetrics() (FileHandling, Node)
Created getWorkDirSizeFilename() used by getMaxWorkDirSize() and storeWorkDirSize() (FileHandling)
Added restart of utility subprocess and aborting job if token extractor has crashed at the end of the event range loop in __main__() (RunJobEvent)
Aborting immediately if Token Extractor has died instead of waiting for AthenaMP to finish, in __main__() (RunJobEvent)
Changed waiting time from 600 to 30, in __main__() (RunJobEvent)
Removed outdated usages of dsname in getGlobalFilePaths() and replaced with scope which replaces dsname as an argument (FAXSiteMover)
Sending scope instead of dsname to getGlobalFilePaths() from findGlobalFilePath() (FAXSiteMover, SiteMover)
Added scope argument to findGlobalFilePath() (FAXSiteMover, SiteMover)
Sending scope to findGlobalFilePath() from get_data() (FAXSiteMover)
Extracting scope in get_data() (FAXSiteMover, aria2cSiteMover)
Changed scope_dict to scope and sending scope_dict[lfn] instead of scope_dict to get_data(), in sitemover_get_data() (Mover)
Removed outdated scope extraction from get_data() (aria2cSiteMover)
Sending scope instead of dataset to getGlobalFilePaths() from convertSURLtoTURLUsingDataset() (Mover)
Renamed convertSURLtoTURLUsingDataset() to convertSURLtoTURLUsingScope() (Mover)
Sending scope instead of dataset to convertSURLtoTURLUsingScope() (also renamed, see previous comment) from convertSURLtoTURL() (Mover)
Added scope argument to convertSURLtoTURL() (Mover)
Sending scope to convertSURLtoTURL() from getTURLs() (Mover)
Sending scope_dict to PFC4TURLs() from mover_get_data() (Mover)
Added scope_dict argument to PFC4TURLs() (Mover)
Sending scope_dict to createPFC4TURLs() from PFC4TURLs() (Mover)
Added scope_dict argument to createPFC4TURLs() (Mover)
Sending lfns and scope_dict to getTURLs() from createPFC4TURLs() (Mover)
Added lfns and scope_dict arguments to getTURLs() (Mover)
Created getMatchingLFN() used by getTURLs() (Mover)
Sending scope_dict to PFC4TURLs() from getPoolFileCatalog() (RunJobEvent)
Corrected 'Failed' -> 'failed' message sent with updateEventRange() in listener() (RunJobEvent)
[Out-commented call for now] Moved discoverAdditionalOutputFiles() from RunJob to FileHandling, added import and removed a comment
Sending scope to findGlobalFilePath() from mover_get_data() (Mover)
Renamed __getMaxWorkDirSize() to __getMaxAllowedWorkDirSize(), used by __checkWorkDir() (Monitor)
Using getDirSize(), getWorkDirSizeFilename() and storeWorkDirSize() in createLogFile() (JobLog)
Now returning xml_source from getFileInfo(), received in mover_get_data() (Mover)
Skipping call to PFC4TURLs() in mover_get_data() in FAX mode (Mover)
Renamed athenamp_std*.txt to athena_std*.txt in __main__() (RunJobEvent)

Code merge with Alexey Anisenkov
- Added new movers sub directory with new site mover (xrdcp) and mover module

Update info from Edward Karavakis:
- Patch for chmod problem seen at BNL

Update info from Wen Guan:
- Added exceptions for ptest uflag in getProdSourceLabel() (pilot)

Non-ATLAS related changes:
- Now generating output file GUIDs in getOutFilesGuids() in case PoolFileCatalog.xml is not to be used (e.g. for AMS) (RunJobUtilities)

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

63.1:

Added missing scope_dict and sourceSite in call to sitemover_get_data() in mover_get_data() (Mover)

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

63.2

Updated the default event index url from ific to cern, in getEventIndexURL() (EventService)
Sending jobReport.json with the metaData field also for event service jobs, in updatePandaServer() (PandaServerClient)
Created _useDirectAccess(), useDirectAccessLAN(), useDirectAccessWAN() (Mover)
Sending hasInput to updateRunCommandList() from __main__() (RunJob, RunJobEvent)
Added hasInput argument to updateRunCommandList() (RunJobUtilities)
Removing --createTAGFileForES instruction from runCommandList in updateRunCommandList() (RunJobUtilities)
Updated setUseEventIndex() to set __useEventIndex variable depending on jobPars (RunJobEvent)
Sending jobPars to setUseEventIndex() from __main__(), and moved the call to setUseEventIndex() until job object is defined (RunJobEvent)
Added a waiting loop in listener() for send event range to finish (RunJobEvent)
Added new variables __sending_event_range, __current_event_range and corresponding getters and setters (RunJobEvent)
Now setting __sending_event_range using setSendingEventRange(), and __current_event_range using setCurrentEventRange() in event range loop in __main__() (RunJobEvent)

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


TODO:

Remove singletons:
- Change __experiment to experiment in Experiment classes
- Use super() in __init__() (ATLASExperiment)
- Same changes to SiteInformation classes

62.1?
Avoiding setting exit code 1008/65 when no jobs were downloaded in getJob(), requested by John Hover (pilot)

REMOVE OTHERSITEMOVER FROM DIST
HUSITEMOVER?

Prior to file registration (i.e. for US sites that still uses the pilot for file registrations), the pilot sets the LFC_HOST env variable; no longer needed for file 
registrations using DQ2 functions test with a job run in the US, BNL e.g. which still uses the pilot for file registrations

todo: remove the explicit usages of schedconfig.lfchost and replace with an experiment specific method (getFileCatalog())
todo: rename pUtil.getExperiment to pUtil.getExperimentObject, correct import in SiteInformation

#### add new error codes 1217-1219 to proddb
Update prodDB for ERR_RUNJOBEXC : "Exception caught by runJob" -> "Exception caught by RunJob*" ? not necessary??
Added new error codes; 1224 (ERR_ESRECOVERABLE), 1225 (ERR_ESMERGERECOVERABLE) (PilotErrors)
