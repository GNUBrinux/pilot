Complete change log for the Pilot 1
-----------------------------------


72.0

General changes:
- Added TURL to file state dictionary in stagein_real(), needed for direct access in prod jobs (mover)
- Now using proper job.isAnalysisJob() in __main__() (RunJob)
- Corrected exception handling in getContainerName() (Singularity)
- Removed sitename from detect_client_location, and from all it's calls (via stagein()), replaced with readpar (mover)
- Added movers to redundancy list in removeRedundantFiles() (ATLASExperiment)

Now using associated storages when looking up replicas by getting all associated endpoints from astorages
- Using resolvePandaAssociatedStorages() instead of _prepare_input_ddm() in resolve_replicas() (mover)
- As discussed in thread "Multiple read DATADISK per PQ"

Resource type
- Added new pilot option -R <resourceType>, forwarded to dispatcher with getJob. Requested by Tadashi Maeno (pilot, Job)

Updates from Wen Guan:

You can view, comment on, or merge this pull request online at:

  https://github.com/PanDAWMS/pilot/pull/167

1. clean 'es_read' activity in pilot: 'es_read' was added to read remotely for cases to run ES when there is a local
storage downtime. It's not used.
2. to support failover for es: attach two storages in agis for ES, if the first one fails, it will failover to the
second storage. For the first storage, it will use 'es_events' activity if defined, otherwise it will use 'pw'
activity. So for opportunistic PQs, we need to define 'es_events', but for normal PQs, we can run ES without defining
'es_events'.
3. update the default zip_time_gap. If pledgedcpu is -1, default zip_time_gap is 600 s (10 minutes). Otherwise it's 2 hours.
4. based on es_failover, ES can support storages blacklisting: either es_events or es_failover can be blacklisted.

Commit Summary

clean "es_read" activity
to support failover for es stageout
update sleep time based on attempts
update to read zip_time_gap in agis
fix objectstore keypaire usage in failover storage
to support blacklist for ES

File Changes

M Mover.py (7)
M RunJobEvent.py (261)
M SiteInformation.py (52)
M movers/mover.py (29)

 https://github.com/PanDAWMS/pilot/pull/168

Commit Summary

in pilotErrorDiag report 'AllSuccess' when all events finish, to distinguish with lost heartbeat cases.
implement maxtime and softkill for es
to use "pr" activtiy to stagein local es premerge files
fail pilot if continously stageout fails

File Changes

M RunJobEvent.py (4)

  https://github.com/PanDAWMS/pilot/pull/171

Commit Summary

clean some old codes

File Changes

M RunJobEvent.py (56)

  https://github.com/PanDAWMS/pilot/pull/172

Commit Summary

fix a bug in mover which fails esmerge jobs

File Changes

M movers/mover.py (2)

  https://github.com/PanDAWMS/pilot/pull/173

Commit Summary

option to define maxwait for tail events

File Changes

M RunJobEvent.py (18)

Updates from Nicolo Magini

  https://github.com/PanDAWMS/pilot/pull/169

Rely only on inFilePosEvtNum flag from PanDA instead.
Fix for https://its.cern.ch/jira/browse/ATLASPANDA-409

Commit Summary

Do not assume in-file positional event ranges for prefetcher

File Changes

M RunJobEvent.py (2)

  https://github.com/PanDAWMS/pilot/pull/170

Commit Summary

Merge pull request #1 from PanDAWMS/main-dev
Fix broken resolve replicas for WAN access
Merge branch 'main-dev' of git://github.com/PanDAWMS/pilot into PanDAWMS-main-dev
Merge branch 'PanDAWMS-main-dev' into main-dev

File Changes

M RunJob.py (2)
M RunJobEvent.py (2)
M movers/mover.py (2)


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


TODO:

todo: remove the explicit usages of schedconfig.lfchost and replace with an experiment specific method (getFileCatalog())
todo: rename pUtil.getExperiment to pUtil.getExperimentObject, correct import in SiteInformation

#### add new error codes 1217-1219 to proddb
Update prodDB for ERR_RUNJOBEXC : "Exception caught by runJob" -> "Exception caught by RunJob*" ? not necessary??
Added new error codes; 1224 (ERR_ESRECOVERABLE), 1225 (ERR_ESMERGERECOVERABLE) (PilotErrors)
