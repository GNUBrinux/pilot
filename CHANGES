Complete change log for the Pilot 1
-----------------------------------


70.0

General changes
- Removed function getNumberOfCores() as it is not used (Node)
- Modernized file open in collectWNInfo() (Node)
- Reset cpuConsumptionTime to -1 if > 10**9 in getNodeStructure(). Requested by Wenjing Wu (PandaServerClient)
- Now looking for local agis_ddmendpoints.json before trying download from AGIS/CVMFS, in loadDDMConfData(). Requested by Wenjing Wu (SiteInformation)
- Added ckpt* to removeRedundantFiles() (ATLASExperiment)
- Using with open in loadURLData(), grammatical change, removed warning text (SiteInformation)
- Added WebDAV protocol ('davs') to GFAL2 mover, requested Frank Berghaus (gfalcopy_sitemover)

Core count and core info
- Simplified setNumberOfCores() as discussed in JIRA ticket https://its.cern.ch/jira/browse/ADCDPA-49
- Renamed setNumberOfCores() to getNumberOfCores() (Node)
- Created getNumberOfCoresFromEnvironment() (Node)
- Now setting job.coreCount in getNewJob() (pilot)
- Created collectCoreInfo() (Node)
- Created isAVirtualMachine() (Node)
- Added core info (threads_per_core, cores_per_socket, sockets and if running in a VM) to benchmark dictionary. Requested by Ilija Vukotic (JobLog)

ATHENA_PROC_NUMBER
- Created addAthenaProcNumber() (ATLASExperiment)
- Now adding ATHENA_PROC_NUMBER explicitly to payload execution command, as long as it has a value > 1 (ATLASExperiment)
- The pilot is not overwriting ATHENA_PROC_NUMBER but is using a tmp variable instead (ATHENA_PROC_NUMBER_JOB)

Direct access
- Removed name conflicts (there is both is_directaccess and is_directaccess() in stagein_real()) (mover)
- Rewrote is_directaccess(), renamed it to get_directaccess(), returning both allow_directaccess and type (mover)
- Sending directaccesstype to resolve_replicas(), added argument (mover)
- Created get_pfns() and get_turls() (mover)
- Created getReplicaDictionaryFromXML() (FileHandling)
- Created addFullPathsAsInput() (RunJobUtilities)
- Updated getDirectAccess() to be stricter (FileHandling)

Updates from Alexander Bogdanchikov

  https://github.com/PanDAWMS/pilot/pull/137

Commit Summary

new ES panda proxy features for BOINC

File Changes

M EventRanges.py (24)
A EventRangesPandaProxy.py (145)
M Job.py (8)
M PILOTVERSION (2)
M RunJobEvent.py (46)
A S3ObjectstorePresignedURLSiteMover.py (510)
M movers/mv_sitemover.py (31)
A movers/pandaproxy_sitemover.py (252)
M movers/sitemovers.py (1)

  https://github.com/PanDAWMS/pilot/pull/143

Commit Summary

more details in the log when download event ranges failure: print exception

File Changes

M EventRanges.py (4)

Updates from Wen Guan:

  https://github.com/PanDAWMS/pilot/pull/138

Commit Summary

  update to set zip as default

File Changes

M RunJobEvent.py (4)

https://github.com/PanDAWMS/pilot/pull/144

1. using storageId but fallback to bucket id if storageid is not available
2. only when storageId is set, objectstoresitemover will build replica.
3. implementation to support multiple buckets.
4. fix getSURL in objectstoresitemover to use pathConvention.
5. replace readpar to use new function. because readpar is reading old schedconf which can be different from the schedconfi the new mover is using.

Commit Summary

use storageid but fallback to bucket id if storageid is not available
fix to only buil replica url when storageId is set
multiple buckets implementation
fix pathConvention in stagein
change default num of buckets to 1
fix getSURL with pathConvention
replace readpar to use new function based on new mover agis

File Changes

M Job.py (18)
M RunJobEvent.py (87)
M SiteInformation.py (18)
M movers/base.py (2)
M movers/mover.py (20)
M movers/objectstore_sitemover.py (42)

 https://github.com/PanDAWMS/pilot/pull/145

Commit Summary

disable tar/zip when pandaproxy is used
fix mover at checking errors part by checking file status, not checking failed_transfers
fix objectstoremover to handle rucio standard paths

File Changes

M Mover.py (2)
M RunJobEvent.py (12)
M UpdateHandler.py (2)
M movers/objectstore_sitemover.py (15)

  https://github.com/PanDAWMS/pilot/pull/146

Commit Summary

pilot failed should be false when no events

File Changes

M RunJobEvent.py (2)

  https://github.com/PanDAWMS/pilot/pull/147

Commit Summary

update
File Changes

M movers/objectstore_sitemover.py (6)

Updates from Mario Lassnig/Frank Berghaus

Rucio now supports the DAV protocol. It uses the protocol to slightly modify it's behavior when talking to a strict DAV endpoint compared to a more relaxed HTTP 
endpoint. Integrating the DynaFed into ATLAS DDM requires Rucio to make this distinction. Davs protocol added to the pilot.

  https://github.com/PanDAWMS/pilot/pull/139

Commit Summary

  add DAVs to protocols supported by rucio

File Changes

M movers/rucio_sitemover.py (2)

Updates from Petr Vokac:

Rucio no longer provides replica location for HTTPS protocol, because the name
was changed to DAVS. We had at least one site where our jobs failed due to
no access to input files using StoRM site mover (GGUS:129509) and there are
more sites that also fail while use StoRM site mover but luckily they fallback
to to lcgcp site mover.

  https://github.com/PanDAWMS/pilot/pull/148

Commit Summary

Updated protocol name "https" -> "davs" for listing rucio replicas

File Changes

M movers/mover.py (2)
M movers/storm_sitemover.py (2)

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

70.1

General changes:
- Fixed conversion problem (%d instead of %s) in collectCoreInfo() (JobLog)

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

70.2

General changes:
- Cleaned up a reset of job.coreCount (wrongly set to 1 when ATHENA_PROC_NUMBER was not set) (RunJobEvent)
- Fixed double occurrence of ATHENA_PROC_NUMBER (RunJobEvent)

Updates from Wen Guan:

  https://github.com/PanDAWMS/pilot/pull/149

Commit Summary

fix download event ranges

File Changes

M EventRanges.py (2)

  https://github.com/PanDAWMS/pilot/pull/150

Commit Summary

Fix to report os ddmendpoint properly to panda

File Changes

M Job.py (2)
M JobLog.py (3)
M pUtil.py (8)

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

70.3

General changes:
- Dropped "here" in asetup options, getASetupOptions(). Requested by G. Rybkin et al (ATLASExperiment)
- Replaced outdated usages of 'maxmemory' and 'memory' with 'maxrss'. Requested by R. Walker et al. (pilot, Monitor)
- Removed outdated sources from getValidURLBase() (ATLASExperiment)

Release verification
- Added missing payload setup verification in getJobExecutionCommand(), requested by Will Buttinger (ATLASExperiment)
- Added new error code, 1244, ERR_NORELEASEFOUND: "No release candidates found" (PilotErrors)

Updates from Wen Guan:

  https://github.com/PanDAWMS/pilot/pull/152

Commit Summary

fix cputime

File Changes

M RunJobEvent.py (2)

  https://github.com/PanDAWMS/pilot/pull/151

Commit Summary

remove explicitly PFC for ES

File Changes

M RunJobEvent.py (2)

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

70.4

General changes:
..

Updates from Andrej Filipcic:

Fixes for release 21 on Nordugrid;
- Renamed getRelease() to getReleaseObsolete() (NordugridATLASExperiment)

Updates from David Cameron:

  https://github.com/PanDAWMS/pilot/pull/153

Commit Summary

support for log to OS in mv mover

File Changes

M ATLASExperiment.py (2)
M movers/mover.py (1)
M movers/mv_sitemover.py (44)

  https://github.com/PanDAWMS/pilot/pull/154

Commit Summary

add new parameters in getSURL

File Changes

M movers/pandaproxy_sitemover.py (2)

  https://github.com/PanDAWMS/pilot/pull/156

Commit Summary

protect updateEventRanges against unexpected responses

File Changes

M EventRangesPandaProxy.py (21)

Updates from Wen Guan:

  https://github.com/PanDAWMS/pilot/pull/157

1. fix wrong name convention in logsToOS
2. keep record of the zipped es files
3. report zipped es file size and checksum, change the scope to 'transient'.
4. fix register logsInOS when the job fails

Commit Summary

fix wrong name convention in logsToOS
keep record the zipped ES files
report ES zip file size and checksum, change the scope to report to rucio
update pathconvention to report es zip files to rucio
fix register logsInOS when the job fails

File Changes

M Job.py (13)
M JobLog.py (15)
M PandaServerClient.py (28)
M RunJobEvent.py (38)
M movers/base.py (2)
M movers/mover.py (8)
M movers/objectstore_sitemover.py (24)
M movers/rucio_sitemover.py (31)

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

TODO:

OS log transfers:
[TODO: set bucket to -1 for failed log transfers in jobMetrics]

todo: remove the explicit usages of schedconfig.lfchost and replace with an experiment specific method (getFileCatalog())
todo: rename pUtil.getExperiment to pUtil.getExperimentObject, correct import in SiteInformation

#### add new error codes 1217-1219 to proddb
Update prodDB for ERR_RUNJOBEXC : "Exception caught by runJob" -> "Exception caught by RunJob*" ? not necessary??
Added new error codes; 1224 (ERR_ESRECOVERABLE), 1225 (ERR_ESMERGERECOVERABLE) (PilotErrors)
